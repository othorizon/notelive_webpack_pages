!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=258)}({116:function(e,t){e.exports=_},12:function(e,t){e.exports=jQuery},121:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},16:function(e,t,n){"use strict";n.r(t),n.d(t,"SERVER_PATH",function(){return o}),n.d(t,"COOLAB_SERVER_PATH",function(){return s}),n.d(t,"CONFIG",function(){return a}),n.d(t,"Note",function(){return r}),n.d(t,"Response",function(){return d});const i="//api.notelive.cn",o={renderPrefix:i+"/render/",queryOne:i+"/server/queryOne",replaceOrInsertOne:i+"/server/replaceOrInsertOne",modifyWorkspacePwd:i+"/server/modifyWorkspacePwd",delWorkspace:i+"/server/delWorkspace",queryWorkspaceTitles:i+"/server/queryWorkspaceTitles"},a={responseCode:{SUCCESS:200,NO_AUTH:505,ERROR:500},workspaceTitlePrefix:"/w/",siteNoteTitle:"note live - 在线记事本",siteFlowTitle:"note live - 在线流程图",flowDefaultData:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="203px" height="64px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36&quot; version=&quot;@DRAWIO-VERSION@&quot; editor=&quot;www.draw.io&quot;&gt;&lt;diagram id=&quot;14058d99-db58-e9f5-3aba-399879c13e25&quot; name=&quot;Page-1&quot;&gt;jZNNk4MgDIZ/jXeVbbe91n5d9tTDnimmwhSNg1jt/vpFCVWnszPLBfIkIfgmRiwr+5PhtfzCHHSUxnkfsX2Upkm62rhtIE9Pth8rDwqjcgqawEX9AMGYaKtyaBaBFlFbVS+hwKoCYReMG4PdMuyGelm15gW8gYvg+p1+q9xKTzfpeuJnUIUMlZP11nuuXNwLg21F9aKU3cbl3SUPd9GHNpLn2M0QO0QsM4jWn8o+Az1oG2Tzecc/vK93G6jsfxJY/OlTHly39PF7bK9OCKeuVuLudgkG6Ln2GSTqpLJwqbkY7M6NQcR20pbaWYk73rCyR14qPUzAGfQDrBKcHNTwZBNsunZIHMWDnCxuBAWvYgrOUKMZ38DicTmOhldDR3eF5k1Due9akDwPMBb6GSJtToAlWPN0IeR1JXxKmGMyu2ko0piYnA3EmhinOSxeN0+9cAdqRzCnto++2b/FDr8=&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-ffcd28-1-ffa500-1-s-0"><stop offset="0%" style="stop-color:#FFCD28"/><stop offset="100%" style="stop-color:#FFA500"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-ffffff-0.9-ffffff-0.1-s-0"><stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.9"/><stop offset="100%" style="stop-color:#ffffff;stop-opacity:0.1"/></linearGradient></defs><g transform="translate(0.5,0.5)"><rect x="0" y="0" width="200" height="60" rx="30" ry="30" fill="#000000" stroke="#000000" transform="translate(2,3)" opacity="0.25"/><rect x="0" y="0" width="200" height="60" rx="30" ry="30" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="none"/><path d="M 31.5 -1 Q -1 -1 -1 31.5 L -1 24 Q 100 42 201 24 L 201 31.5 Q 201 -1 168.5 -1 Z" fill="url(#mx-gradient-ffffff-0.9-ffffff-0.1-s-0)" stroke="none" pointer-events="none"/><g transform="translate(24.5,20.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="150" height="19" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 150px; white-space: nowrap; word-wrap: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Double click here</div></div></foreignObject><text x="75" y="19" fill="#000000" text-anchor="middle" font-size="18px" font-family="Helvetica" font-weight="bold">Double click here</text></switch></g></g></svg>',enableCoolab:!0},s=i+"/coolab";class r{constructor(e){return e&&(this.id=e.id,this.title=e.title,this.queryPassword=e.queryPassword,this.password=e.password,this.content=e.content,this.contentType=e.contentType,this.lockType=e.lockType,this.updateTime=e.updateTime),this.contentType||(this.contentType="markdown"),this}getTitle(){return this.title}getContent(){return this.content||""}getQueryPassword(){return this.queryPassword}getPassword(){return this.password}getContentType(){return this.contentType}getLockType(){return this.lockType}getUpdateTime(){return this.updateTime}setTitle(e){return this.title=e,this}setContent(e){return this.content=e,this}setQueryPassword(e){return this.queryPassword=e,this}setPassword(e){return this.password=e,this}setContentType(e){return this.contentType=e,this}setLockType(e){return this.lockType=e,this}setUpdateTime(e){return this.updateTime=e,this}}class d{constructor(e){return e&&(this.code=e.code,this.msg=e.msg,this.data=e.data),this}getCode(){return this.code}getMsg(){return this.msg}getData(){return this.data}getNote(){return new r(this.data)}}},162:function(e,t,n){"use strict";n.r(t),n.d(t,"install",function(){return r});var i=n(12),o=n.n(i);n(413);const a=n(163),s='\n<div id="updateTips" class="update-tips" style="display:none">\n    <span id="updateTipsContent"></span>\n    <a onclick="document.getElementById(\'updateTips\').style.display=\'none\'" href="javascript:" class="update-tip-close">关闭</a>\n</div>\n';function r(){o()("body").append(s),a.install({onUpdating:()=>{o()("#updateTipsContent").html("有新的内容更新，正在获取....."),o()("#updateTips").show(),console.log("SW Event:","onUpdating")},onUpdateReady:()=>{console.log("SW Event:","onUpdateReady"),o()("#updateTipsContent").html('有新的内容更新,是否现在更新(将会刷新页面)？&emsp;<a id="updateBtn" class=\'click\' href="javascript:"><b>更新</b></a>'),o()("#updateTips").show(),o()("#updateBtn").on("click",function(){a.applyUpdate()})},onUpdated:()=>{console.log("SW Event:","onUpdated"),window.location.reload()},onUpdateFailed:()=>{console.log("SW Event:","onUpdateFailed"),console.error("更新失败"),o()("#updateTipsContent").html("更新失败，请尝试刷新页面")}})}},163:function(e,t){function n(){return"serviceWorker"in navigator&&("https:"===window.location.protocol||"localhost"===window.location.hostname||0===window.location.hostname.indexOf("127."))}function i(){n()&&navigator.serviceWorker.getRegistration().then(function(e){if(e)return e.update()})}setInterval(i,36e5),t.install=function(e){if(e||(e={}),n()){var t=function(e){var t,n,o,a=e.installing||e.waiting;function s(){switch(a.state){case"redundant":i("onUpdateFailed"),a.onstatechange=null;break;case"installing":t||i("onUpdating");break;case"installed":n||i("onUpdateReady");break;case"activated":i("onUpdated"),a.onstatechange=null}}function r(){switch(a.state){case"redundant":a.onstatechange=null;break;case"installing":case"installed":break;case"activated":i("onInstalled"),a.onstatechange=null}}a&&!a.onstatechange&&(e.active?(s(),o=s):(r(),o=r),t=!0,e.waiting&&(n=!0),a.onstatechange=o)},i=function(t){"function"==typeof e[t]&&e[t]({source:"ServiceWorker"})};navigator.serviceWorker.register("/sw.js",{}).then(function(e){e&&(t(e),e.onupdatefound=function(){t(e)})}).catch(function(e){return i("onError"),Promise.reject(e)})}},t.applyUpdate=function(e,t){n()&&navigator.serviceWorker.getRegistration().then(function(n){n&&n.waiting?(n.waiting.postMessage({action:"skipWaiting"}),e&&e()):t&&t()})},t.update=i},246:function(e,t,n){"use strict";function i(e){let t=$(this).attr("class"),n=$("."+t),i=$("."+t+" .card-tabs-stack"),a=0,s=$.extend({theme:""},e),r=$(this).html(),d=$("<div />").addClass("card-tabs-stack").html(r),l=$("<div />").addClass("card-tabs-bar");return n.children("div[data-tab]").each(function(){l.append($("<a />").attr("href","javascript:").attr("data-a_tab",$(this).data("tab")).data("tab",$(this).data("tab")).append($(this).data("tab")))}),n.html("").append(l).append(d),""!==s.theme&&($("."+t+" .card-tabs-bar").addClass(s.theme),i.addClass(s.theme)),i.children("div[data-tab]").each(function(){$(this).hasClass("active")&&($("."+t+" .card-tabs-bar a[data-tab='"+$(this).data("tab")+"']").addClass("active"),o(t,$(this)),$(this).removeClass("active"),a++)}),0===a&&$("."+t+" .card-tabs-bar a:first-child").addClass("active"),$("."+t+" .card-tabs-bar a").click(function(){$("."+t+" .card-tabs-bar a").removeClass("active"),$(this).addClass("active"),o(t,$(this))}),this}function o(e,t){$("."+e+" .card-tabs-stack div[data-tab][data-tab='"+t.data("tab")+"']").show(),$("."+e+" .card-tabs-stack div[data-tab][data-tab!='"+t.data("tab")+"']").hide()}function a(e){if($(this).children(".card-tabs-bar").find("[data-a_tab="+e+"]").length>0)return!0}function s(e,t,n,i){if(a(e))return;let s=$(this).attr("class"),r=$(this).children(".card-tabs-bar");$("."+s+" .card-tabs-stack").append(n);let l=$("<a />");r.append(l.attr("href","javascript:").attr("data-a_tab",e).data("tab",e).append(t)),l.click(function(){$("."+s+" .card-tabs-bar a").removeClass("active"),$(this).addClass("active"),o(s,$(this))}),l.dblclick(()=>{i(l.data("a_tab"))&&d(l,s,e)})}function r(e){$(this).find(".card-tabs-bar a[data-a_tab="+e+"]").trigger("click")}function d(e,t,n){e.prev().trigger("click"),e.remove(),$("."+t+" .card-tabs-stack div[data-tab][data-tab='"+n+"']").remove()}function l(e){let t=$(this).attr("class");d($("."+t+" .card-tabs-bar a[data-a_tab="+e+"]"),t,e)}function h(){let e=$(this).attr("class");return $("."+e+" .card-tabs-bar a.active").data("a_tab")}function c(e){let t=$(this).attr("class");$("."+t+" .card-tabs-bar a[data-a_tab="+e+"]").remove(),$("."+t+" .card-tabs-stack div[data-tab][data-tab='"+e+"']").remove()}function u(e){e.fn.initCardTabs=i,e.fn.appendCardTabs=s,e.fn.openCardTab=r,e.fn.removeCardTabActivePre=l,e.fn.removeCardTab=c,e.fn.hasCardTab=a,e.fn.getActiveId=h}n.r(t),n.d(t,"register",function(){return u})},247:function(e,t,n){(function(t){const i=n(248),o=n(65),a=o.AppEventInstance,s=o.EventType;!function(t){"use strict";var n=function(){},o="undefined"==typeof console?{log:n,debug:n,error:n,warn:n,info:n}:console;if(e.exports||void 0===t.jsMind){var r=t.document,d=function(e){return r.createElement(e)},l=function(e,t){e.hasChildNodes()?e.firstChild.nodeValue=t:e.appendChild(r.createTextNode(t))},h=function(e,t){t instanceof HTMLElement?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e});var c={container:"",editable:!1,theme:null,mode:"full",support_html:!0,view:{hmargin:100,vmargin:50,line_width:2,line_color:"#555"},layout:{hspace:30,vspace:20,pspace:13},default_event_handle:{enable_mousedown_handle:!0,enable_click_handle:!0,enable_dblclick_handle:!0},shortcut:{enable:!0,isHandleCancel:()=>!1,handles:{},mapping:{addchild:45,addbrother:13,editnode:113,delnode:46,toggle:32,left:37,up:38,right:39,down:40}}},u=function(e){u.current=this,this.version="0.4.6";var t={};u.util.json.merge(t,c),u.util.json.merge(t,e),t.container?(this.options=t,this.inited=!1,this.mind=null,this.event_handles=[],this.init()):o.error("the options.container should not be null or empty.")};u.direction={left:-1,center:0,right:1},u.event_type={show:1,resize:2,edit:3,select:4},u.node=function(e,t,n,i,a,s,r,d){e?"number"==typeof t?(void 0===d&&(d=!0),this.id=e,this.index=t,this.topic=n,this.data=i||{nodeType:"note"},this.isroot=a,this.parent=s,this.direction=r,this.expanded=!!d,this.children=[],this._data={}):o.error("invalid node index"):o.error("invalid nodeid")},u.node.compare=function(e,t){var n=e.index,i=t.index;return n>=0&&i>=0?n-i:-1==n&&-1==i?0:-1==n?1:-1==i?-1:0},u.node.inherited=function(e,t){if(e&&t){if(e.id===t.id)return!0;if(e.isroot)return!0;for(var n=e.id,i=t;!i.isroot;)if((i=i.parent).id===n)return!0}return!1},u.node.prototype={get_location:function(){var e=this._data.view;return{x:e.abs_x,y:e.abs_y}},get_size:function(){var e=this._data.view;return{w:e.width,h:e.height}}},u.mind=function(){this.name=null,this.author=null,this.version=null,this.root=null,this.selected=null,this.nodes={}},u.mind.prototype={get_node:function(e){return e in this.nodes?this.nodes[e]:(o.warn("the node[id="+e+"] can not be found"),null)},set_root:function(e,t,n){null==this.root?(this.root=new u.node(e,0,t,n,!0),this._put_node(this.root)):o.error("root node is already exist")},add_node:function(e,t,n,i,a,s,r){if(!u.util.is_node(e)){var d=this.get_node(e);return d?this.add_node(d,t,n,i,a,s,r):(o.error("the parent_node[id="+e+"] can not be found."),null)}var l=a||-1,h=null;if(e.isroot){var c=u.direction.right;c=isNaN(s)?u.direction.right:s!=u.direction.left?u.direction.right:u.direction.left,h=new u.node(t,l,n,i,!1,e,c,r)}else h=new u.node(t,l,n,i,!1,e,e.direction,r);return this._put_node(h)?(e.children.push(h),this._reindex(e)):(o.error("fail, the nodeid '"+h.id+"' has been already exist."),h=null),h},insert_node_before:function(e,t,n,i){if(!u.util.is_node(e)){var a=this.get_node(e);return a?this.insert_node_before(a,t,n,i):(o.error("the node_before[id="+e+"] can not be found."),null)}var s=e.index-.5;return this.add_node(e.parent,t,n,i,s)},get_node_before:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.get_node_before(t):(o.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var n=e.index-2;return n>=0?e.parent.children[n]:null},insert_node_after:function(e,t,n,i){if(!u.util.is_node(e)){var a=this.get_node(node_before);return a?this.insert_node_after(a,t,n,i):(o.error("the node_after[id="+e+"] can not be found."),null)}var s=e.index+.5;return this.add_node(e.parent,t,n,i,s)},get_node_after:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.get_node_after(t):(o.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var n=e.index;return e.parent.children.length>=n?e.parent.children[n]:null},move_node:function(e,t,n,i){if(!u.util.is_node(e)){var a=this.get_node(e);return a?this.move_node(a,t,n,i):(o.error("the node[id="+e+"] can not be found."),null)}return n||(n=e.parent.id),this._move_node(e,t,n,i)},_flow_node_direction:function(e,t){void 0===t?t=e.direction:e.direction=t;for(var n=e.children.length;n--;)this._flow_node_direction(e.children[n],t)},_move_node_internal:function(e,t){if(e&&t)if("_last_"==t)e.index=-1,this._reindex(e.parent);else if("_first_"==t)e.index=0,this._reindex(e.parent);else{var n=t?this.get_node(t):null;null!=n&&null!=n.parent&&n.parent.id==e.parent.id&&(e.index=n.index-.5,this._reindex(e.parent))}return e},_move_node:function(e,t,n,i){if(e&&n){if(e.parent.id!=n){for(var o=e.parent.children,a=o.length;a--;)if(o[a].id==e.id){o.splice(a,1);break}e.parent=this.get_node(n),e.parent.children.push(e)}e.parent.isroot?i==u.direction.left?e.direction=i:e.direction=u.direction.right:e.direction=e.parent.direction,this._move_node_internal(e,t),this._flow_node_direction(e)}return e},remove_node:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.remove_node(t):(o.error("the node[id="+e+"] can not be found."),!1)}if(!e)return o.error("fail, the node can not be found"),!1;if(e.isroot)return o.error("fail, can not remove root node"),!1;null!=this.selected&&this.selected.id==e.id&&(this.selected=null);for(var n=e.children,i=n.length;i--;)this.remove_node(n[i]);n.length=0;for(var a=e.parent.children,s=a.length;s--;)if(a[s].id==e.id){a.splice(s,1);break}for(var r in delete this.nodes[e.id],e)delete e[r];return e=null,!0},_put_node:function(e){return e.id in this.nodes?(o.warn("the nodeid '"+e.id+"' has been already exist."),!1):(this.nodes[e.id]=e,!0)},_reindex:function(e){if(e instanceof u.node){e.children.sort(u.node.compare);for(var t=0;t<e.children.length;t++)e.children[t].index=t+1}}},u.format={node_tree:{example:{meta:{name:"jsMind",author:"hizzgdev@163.com",version:"0.4.6"},format:"node_tree",data:{id:"root",topic:"jsMind Example"}},get_mind:function(e){var t=u.format.node_tree,n=new u.mind;return n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version,t._parse(n,e.data),n},get_data:function(e){var t=u.format.node_tree,n={};return n.meta={name:e.name,author:e.author,version:e.version},n.format="node_tree",n.data=t._buildnode(e.root),n},_parse:function(e,t){var n=u.format.node_tree,i=n._extract_data(t);if(e.set_root(t.id,t.topic,i),"children"in t)for(var o=t.children,a=0;a<o.length;a++)n._extract_subnode(e,e.root,o[a])},_extract_data:function(e){var t={};for(var n in e)"id"!=n&&"topic"!=n&&"children"!=n&&"direction"!=n&&"expanded"!=n&&(t[n]=e[n]);return t},_extract_subnode:function(e,t,n){var i=u.format.node_tree,o=i._extract_data(n),a=null;t.isroot&&(a="left"==n.direction?u.direction.left:u.direction.right);var s=e.add_node(t,n.id,n.topic,o,null,a,n.expanded);if("children"in n)for(var r=n.children,d=0;d<r.length;d++)i._extract_subnode(e,s,r[d])},_buildnode:function(e){var t=u.format.node_tree;if(e instanceof u.node){var n={id:e.id,topic:e.topic,expanded:e.expanded};if(e.parent&&e.parent.isroot&&(n.direction=e.direction==u.direction.left?"left":"right"),null!=e.data){var i=e.data;for(var o in i)"hasNote"!==o&&(n[o]=i[o])}var a=e.children;if(a.length>0){n.children=[];for(var s=0;s<a.length;s++)n.children.push(t._buildnode(a[s]))}return n}}},node_array:{example:{meta:{name:"jsMind",author:"hizzgdev@163.com",version:"0.4.6"},format:"node_array",data:[{id:"root",topic:"jsMind Example",isroot:!0}]},get_mind:function(e){var t=u.format.node_array,n=new u.mind;return n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version,t._parse(n,e.data),n},get_data:function(e){var t=u.format.node_array,n={};return n.meta={name:e.name,author:e.author,version:e.version},n.format="node_array",n.data=[],t._array(e,n.data),n},_parse:function(e,t){var n=u.format.node_array,i=t.slice(0);i.reverse();var a=n._extract_root(e,i);a?n._extract_subnode(e,a,i):o.error("root node can not be found")},_extract_root:function(e,t){for(var n=u.format.node_array,i=t.length;i--;)if("isroot"in t[i]&&t[i].isroot){var o=t[i],a=n._extract_data(o);return e.set_root(o.id,o.topic,a),t.splice(i,1),o.id}return null},_extract_subnode:function(e,t,n){for(var i=u.format.node_array,o=n.length,a=null,s=null,r=0;o--;)if((a=n[o]).parentid==t){s=i._extract_data(a);var d=null,l=a.direction;l&&(d="left"==l?u.direction.left:u.direction.right),e.add_node(t,a.id,a.topic,s,null,d,a.expanded),n.splice(o,1),r++;var h=i._extract_subnode(e,a.id,n);h>0&&(o=n.length,r+=h)}return r},_extract_data:function(e){var t={};for(var n in e)"id"!=n&&"topic"!=n&&"parentid"!=n&&"isroot"!=n&&"direction"!=n&&"expanded"!=n&&(t[n]=e[n]);return t},_array:function(e,t){u.format.node_array._array_node(e.root,t)},_array_node:function(e,t){var n=u.format.node_array;if(e instanceof u.node){var i={id:e.id,topic:e.topic,expanded:e.expanded};if(e.parent&&(i.parentid=e.parent.id),e.isroot&&(i.isroot=!0),e.parent&&e.parent.isroot&&(i.direction=e.direction==u.direction.left?"left":"right"),null!=e.data){var o=e.data;for(var a in o)i[a]=o[a]}t.push(i);for(var s=e.children.length,r=0;r<s;r++)n._array_node(e.children[r],t)}}},freemind:{example:{meta:{name:"jsMind",author:"hizzgdev@163.com",version:"0.4.6"},format:"freemind",data:'<map version="1.0.1"><node ID="root" TEXT="freemind Example"/></map>'},get_mind:function(e){var t=u.format.freemind,n=new u.mind;n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version;var i=e.data,o=t._parse_xml(i),a=t._find_root(o);return t._load_node(n,null,a),n},get_data:function(e){var t=u.format.freemind,n={};n.meta={name:e.name,author:e.author,version:e.version},n.format="freemind";var i=[];return i.push('<map version="1.0.1">'),t._buildmap(e.root,i),i.push("</map>"),n.data=i.join(" "),n},_parse_xml:function(e){var t=null;window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e));return t},_find_root:function(e){for(var t=e.childNodes,n=null,i=null,o=0;o<t.length;o++)if(1==(i=t[o]).nodeType&&"map"==i.tagName){n=i;break}if(n){var a=n.childNodes;n=null;for(o=0;o<a.length;o++)if(1==(i=a[o]).nodeType&&"node"==i.tagName){n=i;break}}return n},_load_node:function(e,t,n){var i=u.format.freemind,o=n.getAttribute("ID"),a=n.getAttribute("TEXT");if(null==a)for(var s=n.childNodes,r=null,d=0;d<s.length;d++)if(1==(r=s[d]).nodeType&&"richcontent"===r.tagName){a=r.textContent;break}var l=i._load_attributes(n),h=!("expanded"in l)||"true"==l.expanded;delete l.expanded;var c=n.getAttribute("POSITION"),_=null;c&&(_="left"==c?u.direction.left:u.direction.right),t?e.add_node(t,o,a,l,null,_,h):e.set_root(o,a,l);var f=n.childNodes,p=null;for(d=0;d<f.length;d++)1==(p=f[d]).nodeType&&"node"==p.tagName&&i._load_node(e,o,p)},_load_attributes:function(e){for(var t=e.childNodes,n=null,i={},o=0;o<t.length;o++)1==(n=t[o]).nodeType&&"attribute"===n.tagName&&(i[n.getAttribute("NAME")]=n.getAttribute("VALUE"));return i},_buildmap:function(e,t){var n=u.format.freemind,i=null;e.parent&&e.parent.isroot&&(i=e.direction===u.direction.left?"left":"right"),t.push("<node"),t.push('ID="'+e.id+'"'),i&&t.push('POSITION="'+i+'"'),t.push('TEXT="'+e.topic+'">'),t.push('<attribute NAME="expanded" VALUE="'+e.expanded+'"/>');var o=e.data;if(null!=o)for(var a in o)t.push('<attribute NAME="'+a+'" VALUE="'+o[a]+'"/>');for(var s=e.children,r=0;r<s.length;r++)n._buildmap(s[r],t);t.push("</node>")}}},u.util={is_node:function(e){return!!e&&e instanceof u.node},ajax:{_xhr:function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest;else try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return e},_eurl:function(e){return encodeURIComponent(e)},request:function(e,t,n,i,a){var s=u.util.ajax,r=null,d=[];for(var l in t)d.push(s._eurl(l)+"="+s._eurl(t[l]));d.length>0&&(r=d.join("&"));var h=s._xhr();h&&(h.onreadystatechange=function(){if(4==h.readyState)if(200==h.netstatus||0==h.netstatus){if("function"==typeof i){var e=u.util.json.string2json(h.responseText);i(null!=e?e:h.responseText)}}else"function"==typeof a?a(h):o.error("xhr request failed.",h)},n=n||"GET",h.open(n,e,!0),h.setRequestHeader("If-Modified-Since","0"),"POST"==n?(h.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),h.send(r)):h.send())},get:function(e,t){return u.util.ajax.request(e,{},"GET",t)},post:function(e,t,n){return u.util.ajax.request(e,t,"POST",n)}},dom:{add_event:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}},canvas:{bezierto:function(e,t,n,i,o){e.beginPath(),e.moveTo(t,n),e.bezierCurveTo(t+2*(i-t)/3,n,t,o,i,o),e.stroke()},lineto:function(e,t,n,i,o){e.beginPath(),e.moveTo(t,n),e.lineTo(i,o),e.stroke()},clear:function(e,t,n,i,o){e.clearRect(t,n,i,o)}},file:{read:function(e,t){var n=new FileReader;n.onload=function(){"function"==typeof t&&t(this.result,e.name)},n.readAsText(e)},save:function(e,n,i){var o;if("function"==typeof t.Blob)o=new Blob([e],{type:n});else{var a=new(t.BlobBuilder||t.MozBlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder);a.append(e),o=a.getBlob(n)}if(navigator.msSaveBlob)navigator.msSaveBlob(o,i);else{var s=(t.URL||t.webkitURL).createObjectURL(o),l=d("a");if("download"in l){l.style.visibility="hidden",l.href=s,l.download=i,r.body.appendChild(l);var h=r.createEvent("MouseEvents");h.initEvent("click",!0,!0),l.dispatchEvent(h),r.body.removeChild(l)}else location.href=s}}},json:{json2string:function(e){if(JSON)try{return JSON.stringify(e)}catch(e){return o.warn(e),o.warn("can not convert to string"),null}},string2json:function(e){if(JSON)try{return JSON.parse(e)}catch(e){return o.warn(e),o.warn("can not parse to json"),null}},merge:function(e,t){for(var n in t)n in e?"object"!=typeof e[n]||"[object object]"!=Object.prototype.toString.call(e[n]).toLowerCase()||e[n].length?e[n]=t[n]:u.util.json.merge(e[n],t[n]):e[n]=t[n];return e}},uuid:{newid:function(){return((new Date).getTime().toString(16)+Math.random().toString(16).substr(2)).substr(2,16)}},text:{is_empty:function(e){return!e||0==e.replace(/\s*/,"").length}}},u.prototype={init:function(){if(!this.inited){this.inited=!0;var e=this.options,t={mode:e.mode,hspace:e.layout.hspace,vspace:e.layout.vspace,pspace:e.layout.pspace},n={container:e.container,support_html:e.support_html,hmargin:e.view.hmargin,vmargin:e.view.vmargin,line_width:e.view.line_width,line_color:e.view.line_color};this.data=new u.data_provider(this),this.layout=new u.layout_provider(this,t),this.view=new u.view_provider(this,n),this.shortcut=new u.shortcut_provider(this,e.shortcut),this.data.init(),this.layout.init(),this.view.init(),this.shortcut.init(),this._event_bind(),u.init_plugins(this)}},enable_edit:function(){this.options.editable=!0},disable_edit:function(){this.options.editable=!1},enable_event_handle:function(e){this.options.default_event_handle["enable_"+e+"_handle"]=!0},disable_event_handle:function(e){this.options.default_event_handle["enable_"+e+"_handle"]=!1},get_editable:function(){return this.options.editable},set_theme:function(e){var t=this.options.theme;this.options.theme=e||null,t!=this.options.theme&&(this.view.reset_theme(),this.view.reset_custom_style())},_event_bind:function(){this.view.add_event(this,"mousedown",this.mousedown_handle),this.view.add_event(this,"click",this.click_handle),this.view.add_event(this,"dblclick",this.dblclick_handle)},mousedown_handle:function(e){if(this.options.default_event_handle.enable_mousedown_handle){var t=e.target||event.srcElement,n=this.view.get_binded_nodeid(t);n?this.select_node(n):this.select_clear()}},click_handle:function(e){if(this.options.default_event_handle.enable_click_handle){var t=e.target||event.srcElement;if(this.view.is_expander(t))(n=this.view.get_binded_nodeid(t))&&this.toggle_node(n);else if(t.startEdit){var n=this.view.get_binded_nodeid(t);clearTimeout(this.timerEdit),this.timerEdit=setTimeout(()=>this.begin_edit(n),300)}}},dblclick_handle:function(e){if(this.options.default_event_handle.enable_dblclick_handle){var t=e.target||event.srcElement;this.view.get_binded_nodeid(t)&&!this.view.is_editing()&&(clearTimeout(this.timerEdit),this.shortcut.handles.openNote.call(this,this,e))}},begin_edit:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.begin_edit(t):(o.error("the node[id="+e+"] can not be found."),!1)}this.get_editable()?this.view.edit_node_begin(e):o.error("fail, this mind map is not editable.")},end_edit:function(){this.view.edit_node_end()},toggle_node:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.toggle_node(t):void o.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.toggle_node(e),this.view.relayout(),this.view.restore_location(e))},expand_node:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.expand_node(t):void o.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.expand_node(e),this.view.relayout(),this.view.restore_location(e))},collapse_node:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.collapse_node(t):void o.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.collapse_node(e),this.view.relayout(),this.view.restore_location(e))},expand_all:function(){this.layout.expand_all(),this.view.relayout()},collapse_all:function(){this.layout.collapse_all(),this.view.relayout()},expand_to_depth:function(e){this.layout.expand_to_depth(e),this.view.relayout()},_reset:function(){this.view.reset(),this.layout.reset(),this.data.reset()},_show:function(e){var t=e||u.format.node_array.example;this.mind=this.data.load(t),this.mind?(o.debug("data.load ok"),this.view.load(),o.debug("view.load ok"),this.layout.layout(),o.debug("layout.layout ok"),this.view.show(!0),o.debug("view.show ok"),this.invoke_event_handle(u.event_type.show,{data:[e]})):o.error("data.load error")},show:function(e){this._reset(),this._show(e)},get_meta:function(){return{name:this.mind.name,author:this.mind.author,version:this.mind.version}},get_data:function(e){var t=e||"node_tree";return this.data.get_data(t)},get_root:function(){return this.mind.root},get_node:function(e){return this.mind.get_node(e)},add_node:function(e,t,n,i){if(this.get_editable()){var a=this.mind.add_node(e,t,n,i);return a&&(this.view.add_node(a),this.layout.layout(),this.view.show(!1),this.view.reset_node_custom_style(a),this.expand_node(e),this.invoke_event_handle(u.event_type.edit,{evt:"add_node",data:[e.id,t,n,i],node:t})),a}return o.error("fail, this mind map is not editable"),null},insert_node_before:function(e,t,n,i){if(this.get_editable()){var a=u.util.is_node(e)?e.id:e,s=this.mind.insert_node_before(e,t,n,i);return s&&(this.view.add_node(s),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(u.event_type.edit,{evt:"insert_node_before",data:[a,t,n,i],node:t})),s}return o.error("fail, this mind map is not editable"),null},insert_node_after:function(e,t,n,i){if(this.get_editable()){var a=u.util.is_node(e)?e.id:e,s=this.mind.insert_node_after(e,t,n,i);return s&&(this.view.add_node(s),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(u.event_type.edit,{evt:"insert_node_after",data:[a,t,n,i],node:t})),s}return o.error("fail, this mind map is not editable"),null},remove_node:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.remove_node(t):(o.error("the node[id="+e+"] can not be found."),!1)}if(this.get_editable()){if(e.isroot)return o.error("fail, can not remove root node"),!1;var n=e.id,i=e.parent.id,a=this.get_node(i);return this.view.save_location(a),this.view.remove_node(e),this.mind.remove_node(e),this.layout.layout(),this.view.show(!1),this.view.restore_location(a),this.invoke_event_handle(u.event_type.edit,{evt:"remove_node",data:[n],node:i}),!0}return o.error("fail, this mind map is not editable"),!1},update_node:function(e,t){if(this.get_editable())if(u.util.text.is_empty(t))o.warn("fail, topic can not be empty");else{var n=this.get_node(e);if(n){if(n.topic===t)return o.info("nothing changed"),void this.view.update_node(n);n.topic=t,this.view.update_node(n),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(u.event_type.edit,{evt:"update_node",data:[e,t],node:e})}}else o.error("fail, this mind map is not editable")},move_node:function(e,t,n,i){if(this.get_editable()){var a=this.mind.move_node(e,t,n,i);a&&(this.view.update_node(a),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(u.event_type.edit,{evt:"move_node",data:[e,t,n,i],node:e}))}else o.error("fail, this mind map is not editable")},select_node:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.select_node(t):void o.error("the node[id="+e+"] can not be found.")}this.layout.is_visible(e)&&(this.mind.selected=e,this.view.select_node(e))},get_selected_node:function(){return this.mind?this.mind.selected:null},select_clear:function(){this.mind&&(this.mind.selected=null,this.view.select_clear())},is_node_visible:function(e){return this.layout.is_visible(e)},find_node_before:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.find_node_before(t):void o.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var n=null;if(e.parent.isroot)for(var i=e.parent.children,a=null,s=null,r=0;r<i.length;r++)s=i[r],e.direction===s.direction&&(e.id===s.id&&(n=a),a=s);else n=this.mind.get_node_before(e);return n},find_node_after:function(e){if(!u.util.is_node(e)){var t=this.get_node(e);return t?this.find_node_after(t):void o.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var n=null;if(e.parent.isroot){for(var i=e.parent.children,a=!1,s=null,r=0;r<i.length;r++)if(s=i[r],e.direction===s.direction){if(a){n=s;break}e.id===s.id&&(a=!0)}}else n=this.mind.get_node_after(e);return n},set_node_color:function(e,t,n){if(!this.get_editable())return o.error("fail, this mind map is not editable"),null;var i=this.mind.get_node(e);i&&(t&&(i.data["background-color"]=t),n&&(i.data["foreground-color"]=n),this.view.reset_node_custom_style(i))},set_node_font_style:function(e,t,n,i){if(!this.get_editable())return o.error("fail, this mind map is not editable"),null;var a=this.mind.get_node(e);a&&(t&&(a.data["font-size"]=t),n&&(a.data["font-weight"]=n),i&&(a.data["font-style"]=i),this.view.reset_node_custom_style(a),this.view.update_node(a),this.layout.layout(),this.view.show(!1))},set_node_background_image:function(e,t,n,i,a){if(!this.get_editable())return o.error("fail, this mind map is not editable"),null;var s=this.mind.get_node(e);s&&(t&&(s.data["background-image"]=t),n&&(s.data.width=n),i&&(s.data.height=i),a&&(s.data["background-rotation"]=a),this.view.reset_node_custom_style(s),this.view.update_node(s),this.layout.layout(),this.view.show(!1))},set_node_background_rotation:function(e,t){if(!this.get_editable())return o.error("fail, this mind map is not editable"),null;var n=this.mind.get_node(e);if(n){if(!n.data["background-image"])return o.error("fail, only can change rotation angle of node with background image"),null;n.data["background-rotation"]=t,this.view.reset_node_custom_style(n),this.view.update_node(n),this.layout.layout(),this.view.show(!1)}},resize:function(){this.view.resize()},add_event_listener:function(e){"function"==typeof e&&this.event_handles.push(e)},invoke_event_handle:function(e,n){var i=this;t.setTimeout(function(){i._invoke_event_handle(e,n)},0)},_invoke_event_handle:function(e,t){for(var n=this.event_handles.length,i=0;i<n;i++)this.event_handles[i](e,t)}},u.data_provider=function(e){this.jm=e},u.data_provider.prototype={init:function(){o.debug("data.init")},reset:function(){o.debug("data.reset")},load:function(e){var t=null,n=null;return"node_array"==(t="object"==typeof e?e.format?e.format:"node_tree":"freemind")?n=u.format.node_array.get_mind(e):"node_tree"==t?n=u.format.node_tree.get_mind(e):"freemind"==t?n=u.format.freemind.get_mind(e):o.warn("unsupported format"),n},get_data:function(e){var t=null;return"node_array"==e?t=u.format.node_array.get_data(this.jm.mind):"node_tree"==e?t=u.format.node_tree.get_data(this.jm.mind):"freemind"==e?t=u.format.freemind.get_data(this.jm.mind):o.error("unsupported "+e+" format"),t}},u.layout_provider=function(e,t){this.opts=t,this.jm=e,this.isside="side"==this.opts.mode,this.bounds=null,this.cache_valid=!1},u.layout_provider.prototype={init:function(){o.debug("layout.init")},reset:function(){o.debug("layout.reset"),this.bounds={n:0,s:0,w:0,e:0}},layout:function(){o.debug("layout.layout"),this.layout_direction(),this.layout_offset()},layout_direction:function(){this._layout_direction_root()},_layout_direction_root:function(){var e=this.jm.mind.root,t=null;"layout"in e._data?t=e._data.layout:(t={},e._data.layout=t);var n=e.children,i=n.length;if(t.direction=u.direction.center,t.side_index=0,this.isside)for(var o=i;o--;)this._layout_direction_side(n[o],u.direction.right,o);else{o=i;for(var a=null;o--;)(a=n[o]).direction==u.direction.left?this._layout_direction_side(a,u.direction.left,o):this._layout_direction_side(a,u.direction.right,o)}},_layout_direction_side:function(e,t,n){var i=null;"layout"in e._data?i=e._data.layout:(i={},e._data.layout=i);var o=e.children,a=o.length;i.direction=t,i.side_index=n;for(var s=a;s--;)this._layout_direction_side(o[s],t,s)},layout_offset:function(){var e=this.jm.mind.root,t=e._data.layout;t.offset_x=0,t.offset_y=0,t.outer_height=0;for(var n=e.children,i=n.length,o=[],a=[],s=null;i--;)(s=n[i])._data.layout.direction==u.direction.right?a.unshift(s):o.unshift(s);t.left_nodes=o,t.right_nodes=a,t.outer_height_left=this._layout_offset_subnodes(o),t.outer_height_right=this._layout_offset_subnodes(a),this.bounds.e=e._data.view.width/2,this.bounds.w=0-this.bounds.e,this.bounds.n=0,this.bounds.s=Math.max(t.outer_height_left,t.outer_height_right)},_layout_offset_subnodes:function(e){for(var t=0,n=e.length,i=n,o=null,a=0,s=null,r=0,d=null;i--;)s=(o=e[i])._data.layout,null==d&&(d=o.parent._data),a=this._layout_offset_subnodes(o.children),o.expanded||(a=0,this.set_visible(o.children,!1)),a=Math.max(o._data.view.height,a),s.outer_height=a,s.offset_y=r-a/2,s.offset_x=this.opts.hspace*s.direction+d.view.width*(d.layout.direction+s.direction)/2,o.parent.isroot||(s.offset_x+=this.opts.pspace*s.direction),r=r-a-this.opts.vspace,t+=a;n>1&&(t+=this.opts.vspace*(n-1)),i=n;for(var l=t/2;i--;)(o=e[i])._data.layout.offset_y+=l;return t},_layout_offset_subnodes_height:function(e){for(var t=0,n=e.length,i=n,o=null,a=0,s=null,r=0,d=null;i--;)s=(o=e[i])._data.layout,null==d&&(d=o.parent._data),a=this._layout_offset_subnodes_height(o.children),o.expanded||(a=0),a=Math.max(o._data.view.height,a),s.outer_height=a,s.offset_y=r-a/2,r=r-a-this.opts.vspace,t+=a;n>1&&(t+=this.opts.vspace*(n-1)),i=n;for(var l=t/2;i--;)(o=e[i])._data.layout.offset_y+=l;return t},get_node_offset:function(e){var t=e._data.layout,n=null;if("_offset_"in t&&this.cache_valid?n=t._offset_:(n={x:-1,y:-1},t._offset_=n),-1==n.x||-1==n.y){var i=t.offset_x,o=t.offset_y;if(!e.isroot){var a=this.get_node_offset(e.parent);i+=a.x,o+=a.y}n.x=i,n.y=o}return n},get_node_point:function(e){var t=e._data.view,n=this.get_node_offset(e),i={};return i.x=n.x+t.width*(e._data.layout.direction-1)/2,i.y=n.y-t.height/2,i},get_node_point_in:function(e){return this.get_node_offset(e)},get_node_point_out:function(e){var t=e._data.layout,n=null;if("_pout_"in t&&this.cache_valid?n=t._pout_:(n={x:-1,y:-1},t._pout_=n),-1==n.x||-1==n.y)if(e.isroot)n.x=0,n.y=0;else{var i=e._data.view,o=this.get_node_offset(e);n.x=o.x+(i.width+this.opts.pspace)*e._data.layout.direction,n.y=o.y}return n},get_expander_point:function(e){var t=this.get_node_point_out(e),n={};return e._data.layout.direction==u.direction.right?n.x=t.x-this.opts.pspace:n.x=t.x,n.y=t.y-Math.ceil(this.opts.pspace/2),n},get_min_size:function(){var e=this.jm.mind.nodes,t=null,n=null;for(var i in e)t=e[i],(n=this.get_node_point_out(t)).x>this.bounds.e&&(this.bounds.e=n.x),n.x<this.bounds.w&&(this.bounds.w=n.x);return{w:this.bounds.e-this.bounds.w,h:this.bounds.s-this.bounds.n}},toggle_node:function(e){e.isroot||(e.expanded?this.collapse_node(e):this.expand_node(e))},expand_node:function(e){e.expanded=!0,this.part_layout(e),this.set_visible(e.children,!0)},collapse_node:function(e){e.expanded=!1,this.part_layout(e),this.set_visible(e.children,!1)},expand_all:function(){var e,t=this.jm.mind.nodes,n=0;for(var i in t)(e=t[i]).expanded||(e.expanded=!0,n++);if(n>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}},collapse_all:function(){var e,t=this.jm.mind.nodes,n=0;for(var i in t)(e=t[i]).expanded&&!e.isroot&&(e.expanded=!1,n++);if(n>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}},expand_to_depth:function(e,t,n){if(!(e<1))for(var i=t||this.jm.mind.root.children,o=n||1,a=i.length,s=null;a--;)s=i[a],o<e&&(s.expanded||this.expand_node(s),this.expand_to_depth(e,s.children,o+1)),o==e&&s.expanded&&this.collapse_node(s)},part_layout:function(e){var t=this.jm.mind.root;if(t){var n=t._data.layout;e.isroot?(n.outer_height_right=this._layout_offset_subnodes_height(n.right_nodes),n.outer_height_left=this._layout_offset_subnodes_height(n.left_nodes)):e._data.layout.direction==u.direction.right?n.outer_height_right=this._layout_offset_subnodes_height(n.right_nodes):n.outer_height_left=this._layout_offset_subnodes_height(n.left_nodes),this.bounds.s=Math.max(n.outer_height_left,n.outer_height_right),this.cache_valid=!1}else o.warn("can not found root node")},set_visible:function(e,t){for(var n=e.length,i=null;n--;)(i=e[n])._data.layout,i.expanded?this.set_visible(i.children,t):this.set_visible(i.children,!1),i.isroot||(i._data.layout.visible=t)},is_expand:function(e){return e.expanded},is_visible:function(e){var t=e._data.layout;return!("visible"in t&&!t.visible)}},u.view_provider=function(e,t){this.opts=t,this.jm=e,this.layout=e.layout,this.container=null,this.e_panel=null,this.e_nodes=null,this.e_canvas=null,this.canvas_ctx=null,this.size={w:0,h:0},this.selected_node=null,this.editing_node=null},u.view_provider.prototype={init:function(){var e,t;if(o.debug("view.init"),this.container=(t=this.opts.container)&&"object"==typeof t&&1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument?this.opts.container:(e=this.opts.container,r.getElementById(e)),this.container){this.e_panel=d("div"),this.e_canvas=d("canvas"),this.e_nodes=d("jmnodes"),this.e_editor=d("textarea"),this.e_editor.style.maxWidth="300px",this.e_editor.style.maxHeight="500px",this.e_editor.maxLength="500",this.e_editor.style.whiteSpace="noWrap",this.e_editor_test=r.getElementById("testWidth"),function(e,t){let n=null,i=function(e){n&&(clearTimeout(n),n=null),n=setTimeout(function(){_(e,t)},200)};e.addEventListener?(e.addEventListener("input",function(){_(e,t,1)},!1),_(e,t)):e.attachEvent&&(e.attachEvent("onpropertychange",function(){_(e,t)}),_(e,t)),window.VBArray&&window.addEventListener&&(e.attachEvent("onkeydown",function(){let t=window.event.keyCode;8!==t&&46!==t||i(e)}),e.attachEvent("oncut",function(){i(e)}))}(this.e_editor,this.e_editor_test),this.e_panel.className="jsmind-inner",this.e_panel.appendChild(this.e_canvas),this.e_panel.appendChild(this.e_nodes),this.e_editor.className="jsmind-editor",this.actualZoom=1,this.zoomStep=.1,this.minZoom=.5,this.maxZoom=2;var n=this;u.util.dom.add_event(this.e_editor,"keydown",function(e){var t=e||event;(t.ctrlKey||t.altKey||t.metaKey)&&13===t.keyCode||t.shiftKey&&13===t.keyCode||(13===t.keyCode?(n.edit_node_end(),t.stopPropagation()):27===t.keyCode&&(n.e_editor.value="",n.edit_node_end(),t.stopPropagation()))}),u.util.dom.add_event(this.e_editor,"blur",function(e){n.edit_node_end()}),this.container.appendChild(this.e_panel),this.init_canvas()}else o.error("the options.view.container was not be found in dom")},add_event:function(e,t,n){u.util.dom.add_event(this.e_nodes,t,function(t){var i=t||event;n.call(e,i)})},get_binded_nodeid:function(e){if(null==e)return null;var t=e.tagName.toLowerCase();return"jmnodes"==t||"body"==t||"html"==t?null:"jmnode"==t||"jmexpander"==t?e.getAttribute("nodeid"):this.get_binded_nodeid(e.parentElement)},is_expander:function(e){return"jmexpander"==e.tagName.toLowerCase()},reset:function(){o.debug("view.reset"),this.selected_node=null,this.clear_lines(),this.clear_nodes(),this.reset_theme()},reset_theme:function(){var e=this.jm.options.theme;this.e_nodes.className=e?"theme-"+e:""},reset_custom_style:function(){var e=this.jm.mind.nodes;for(var t in e)this.reset_node_custom_style(e[t])},load:function(){o.debug("view.load"),this.init_nodes()},expand_size:function(){var e=this.layout.get_min_size(),t=e.w+2*this.opts.hmargin,n=e.h+2*this.opts.vmargin,i=this.e_panel.clientWidth,o=this.e_panel.clientHeight;i<t&&(i=t),o<n&&(o=n),this.size.w=i,this.size.h=o},init_canvas:function(){var e=this.e_canvas.getContext("2d");this.canvas_ctx=e},init_nodes_size:function(e){var t=e._data.view;t.width=t.element.clientWidth,t.height=t.element.clientHeight},init_nodes:function(){var e=this.jm.mind.nodes,t=r.createDocumentFragment();for(var n in e)this.create_node_element(e[n],t);for(var n in this.e_nodes.appendChild(t),e)this.init_nodes_size(e[n])},add_node:function(e){this.create_node_element(e,this.e_nodes),this.init_nodes_size(e)},create_node_element:function(e,t){var n=null;"view"in e._data?n=e._data.view:(n={},e._data.view=n);var o=d("jmnode");if(e.isroot)o.className="root";else{var a=d("jmexpander");l(a,"-"),a.setAttribute("nodeid",e.id),a.style.visibility="hidden",t.appendChild(a),n.expander=a}e.topic&&(this.opts.support_html?h(o,e.data.hasNote?i.withIcon(i.toHtml(e.topic),e.data.nodeType):i.toHtml(e.topic)):l(o,e.topic)),o.setAttribute("nodeid",e.id),o.style.visibility="hidden",this._reset_node_custom_style(o,e.data),t.appendChild(o),n.element=o},remove_node:function(e){null!=this.selected_node&&this.selected_node.id==e.id&&(this.selected_node=null),null!=this.editing_node&&this.editing_node.id==e.id&&(e._data.view.element.removeChild(this.e_editor),this.editing_node=null);for(var t=e.children,n=t.length;n--;)this.remove_node(t[n]);if(e._data.view){var i=e._data.view.element,o=e._data.view.expander;this.e_nodes.removeChild(i),this.e_nodes.removeChild(o),e._data.view.element=null,e._data.view.expander=null}},update_node:function(e){var t=e._data.view,n=t.element;e.topic&&(this.opts.support_html?h(n,e.data.hasNote?i.withIcon(i.toHtml(e.topic),e.data.nodeType):i.toHtml(e.topic)):l(n,e.topic+(e.data.hasNote?"●":""))),t.width=n.clientWidth,t.height=n.clientHeight},select_node:function(e){this.selected_node&&(this.selected_node._data.view.element.className=this.selected_node._data.view.element.className.replace(/\s*selected\b/i,""),this.reset_node_custom_style(this.selected_node),this.selected_node._data.view.element.startEdit=this.last_click_node===e),this.last_click_node=e,e&&(this.selected_node=e,e._data.view.element.className+=" selected",this.clear_node_custom_style(e)),a.emit(s.jsMindSelectNode,e)},select_clear:function(){this.select_node(null)},get_editing_node:function(){return this.editing_node},is_editing:function(){return!!this.editing_node},edit_node_begin:function(e){if(e.topic){null!=this.editing_node&&this.edit_node_end(),this.editing_node=e;var t=e._data.view.element,n=e.topic,i=getComputedStyle(t);this.e_editor.value=n,this.e_editor.style.height="10px",this.e_editor.style.width=t.clientWidth-parseInt(i.getPropertyValue("padding-left"))-parseInt(i.getPropertyValue("padding-right"))+"px",t.innerHTML="",t.appendChild(this.e_editor),t.style.zIndex=5,this.e_editor.focus(),this.e_editor.select(),_(this.e_editor,this.e_editor_test)}else o.warn("don't edit image nodes")},edit_node_end:function(){if(null!=this.editing_node){var e=this.editing_node;this.editing_node=null;var t=e._data.view.element,n=this.e_editor.value;t.style.zIndex="auto",t.removeChild(this.e_editor),u.util.text.is_empty(n)||e.topic===n?this.opts.support_html?h(t,e.data.hasNote?i.withIcon(i.toHtml(e.topic),e.data.nodeType):i.toHtml(e.topic)):l(t,e.topic+(e.data.hasNote?"●":"")):this.jm.update_node(e.id,n)}},get_view_offset:function(){var e=this.layout.bounds;return{x:(this.size.w-e.e-e.w)/2,y:this.size.h/2}},resize:function(){this.e_canvas.width=1,this.e_canvas.height=1,this.e_nodes.style.width="1px",this.e_nodes.style.height="1px",this.expand_size(),this._show()},_show:function(){this.e_canvas.width=this.size.w,this.e_canvas.height=this.size.h,this.e_nodes.style.width=this.size.w+"px",this.e_nodes.style.height=this.size.h+"px",this.show_nodes(),this.show_lines(),this.jm.invoke_event_handle(u.event_type.resize,{data:[]})},zoomIn:function(){return this.setZoom(this.actualZoom+this.zoomStep)},zoomOut:function(){return this.setZoom(this.actualZoom-this.zoomStep)},setZoom:function(e){if(e<this.minZoom||e>this.maxZoom)return!1;this.actualZoom=e;for(var t=0;t<this.e_panel.children.length;t++)this.e_panel.children[t].style.transform="scale("+e+")";return this.show(!0),!0},_center_root:function(){var e=this.e_panel.clientWidth,t=this.e_panel.clientHeight;if(this.size.w>e){var n=this.get_view_offset();this.e_panel.scrollLeft=n.x-e/2}this.size.h>t&&(this.e_panel.scrollTop=(this.size.h-t)/2)},show:function(e){o.debug("view.show"),this.expand_size(),this._show(),e&&this._center_root()},relayout:function(){this.expand_size(),this._show()},save_location:function(e){var t=e._data.view;t._saved_location={x:parseInt(t.element.style.left)-this.e_panel.scrollLeft,y:parseInt(t.element.style.top)-this.e_panel.scrollTop}},restore_location:function(e){var t=e._data.view;this.e_panel.scrollLeft=parseInt(t.element.style.left)-t._saved_location.x,this.e_panel.scrollTop=parseInt(t.element.style.top)-t._saved_location.y},clear_nodes:function(){var e=this.jm.mind;if(null!=e){var t=e.nodes,n=null;for(var i in t)(n=t[i])._data.view.element=null,n._data.view.expander=null;this.e_nodes.innerHTML=""}},show_nodes:function(){var e=this.jm.mind.nodes,t=null,n=null,i=null,o=null,a=null,s="-",r=null,d=this.get_view_offset();for(var h in e)n=(r=(t=e[h])._data.view).element,i=r.expander,this.layout.is_visible(t)?(this.reset_node_custom_style(t),o=this.layout.get_node_point(t),r.abs_x=d.x+o.x,r.abs_y=d.y+o.y,n.style.left=d.x+o.x+"px",n.style.top=d.y+o.y+"px",n.style.display="",n.style.visibility="visible",!t.isroot&&t.children.length>0&&(s=t.expanded?"-":"+",a=this.layout.get_expander_point(t),i.style.left=d.x+a.x+"px",i.style.top=d.y+a.y+"px",i.style.display="",i.style.visibility="visible",l(i,s)),t.isroot||0!=t.children.length||(i.style.display="none",i.style.visibility="hidden")):(n.style.display="none",i.style.display="none")},reset_node_custom_style:function(e){this._reset_node_custom_style(e._data.view.element,e.data)},_reset_node_custom_style:function(e,t){if("background-color"in t&&(e.style.backgroundColor=t["background-color"]),"foreground-color"in t&&(e.style.color=t["foreground-color"]),"width"in t&&(e.style.width=t.width+"px"),"height"in t&&(e.style.height=t.height+"px"),"font-size"in t&&(e.style.fontSize=t["font-size"]+"px"),"font-weight"in t&&(e.style.fontWeight=t["font-weight"]),"font-style"in t&&(e.style.fontStyle=t["font-style"]),"background-image"in t){var n=t["background-image"];if(n.startsWith("data")&&t.width&&t.height){var i=new Image;i.onload=function(){var t=d("canvas");t.width=e.clientWidth,t.height=e.clientHeight;if(t.getContext){t.getContext("2d").drawImage(this,2,2,e.clientWidth,e.clientHeight);var n=t.toDataURL();e.style.backgroundImage="url("+n+")"}},i.src=n}else e.style.backgroundImage="url("+n+")";e.style.backgroundSize="99%","background-rotation"in t&&(e.style.transform="rotate("+t["background-rotation"]+"deg)")}},clear_node_custom_style:function(e){var t=e._data.view.element;t.style.backgroundColor="",t.style.color=""},clear_lines:function(e){var t=e||this.canvas_ctx;u.util.canvas.clear(t,0,0,this.size.w,this.size.h)},show_lines:function(e){this.clear_lines(e);var t=this.jm.mind.nodes,n=null,i=null,o=null,a=this.get_view_offset();for(var s in t)(n=t[s]).isroot||"visible"in n._data.layout&&!n._data.layout.visible||(i=this.layout.get_node_point_in(n),o=this.layout.get_node_point_out(n.parent),this.draw_line(o,i,a,e))},draw_line:function(e,t,n,i){var o=i||this.canvas_ctx;o.strokeStyle=this.opts.line_color,o.lineWidth=this.opts.line_width,o.lineCap="round",u.util.canvas.bezierto(o,e.x+n.x,e.y+n.y,t.x+n.x,t.y+n.y)}},u.shortcut_provider=function(e,t){this.jm=e,this.opts=t,this.mapping=t.mapping,this.handles=t.handles,this.isHandleCancel=t.isHandleCancel,this._mapping={}},u.shortcut_provider.prototype={init:function(){for(var e in u.util.dom.add_event(r,"keydown",this.handler.bind(this)),this.handles.addchild=this.handle_addchild,this.handles.addbrother=this.handle_addbrother,this.handles.editnode=this.handle_editnode,this.handles.delnode=this.handle_delnode,this.handles.toggle=this.handle_toggle,this.handles.up=this.handle_up,this.handles.down=this.handle_down,this.handles.left=this.handle_left,this.handles.right=this.handle_right,this.mapping)this.mapping[e]&&e in this.handles&&(this._mapping[this.mapping[e]]=this.handles[e])},enable_shortcut:function(){this.opts.enable=!0},disable_shortcut:function(){this.opts.enable=!1},handler:function(e){if(!this.jm.view.is_editing()&&!this.isHandleCancel()){var t=e||event;if(!this.opts.enable)return!0;var n=t.keyCode,i=1e3*(e.ctrlKey||e.metaKey||0);0===i&&(i=2e3*(e.altKey||0)),0===i&&(i=3e3*(e.shiftKey||0)),(n+=i)in this._mapping&&this._mapping[n].call(this,this.jm,e),"anykey"in this._mapping&&this._mapping.anykey.call(this,this.jm,e)}},handle_addchild:function(e,t){var n=e.get_selected_node();if(n){t.preventDefault();var i=u.util.uuid.newid();e.add_node(n,i,"New Node")&&(e.select_node(i),e.begin_edit(i))}},handle_addbrother:function(e,t){var n=e.get_selected_node();if(n&&!n.isroot){t.preventDefault();var i=u.util.uuid.newid();e.insert_node_after(n,i,"New Node")&&(e.select_node(i),e.begin_edit(i))}},handle_editnode:function(e,t){var n=e.get_selected_node();n&&(t.preventDefault(),e.begin_edit(n))},handle_delnode:function(e,t){var n=e.get_selected_node();n&&!n.isroot&&(e.select_node(e.find_node_before(n)||n.parent),e.remove_node(n))},handle_toggle:function(e,t){var n=t||event,i=e.get_selected_node();i&&(e.toggle_node(i.id),n.stopPropagation(),n.preventDefault())},handle_up:function(e,t){var n=t||event,i=e.get_selected_node();if(i){var o=e.find_node_before(i);if(!o){var a=e.find_node_before(i.parent);a&&a.children.length>0&&(o=a.children[a.children.length-1])}o&&e.select_node(o),n.stopPropagation(),n.preventDefault()}},handle_down:function(e,t){var n=t||event,i=e.get_selected_node();if(i){var o=e.find_node_after(i);if(!o){var a=e.find_node_after(i.parent);a&&a.children.length>0&&(o=a.children[0])}o&&e.select_node(o),n.stopPropagation(),n.preventDefault()}},handle_left:function(e,t){this._handle_direction(e,t,u.direction.left)},handle_right:function(e,t){this._handle_direction(e,t,u.direction.right)},_handle_direction:function(e,t,n){var i=t||event,o=e.get_selected_node(),a=null;if(o){if(o.isroot){for(var s=o.children,r=[],d=0;d<s.length;d++)s[d].direction===n&&r.push(d);a=s[r[Math.floor((r.length-1)/2)]]}else if(o.direction===n){var l=(r=o.children).length;l>0&&(a=r[Math.floor((l-1)/2)])}else a=o.parent;a&&e.select_node(a),i.stopPropagation(),i.preventDefault()}}},u.plugin=function(e,t){this.name=e,this.init=t},u.plugins=[],u.register_plugin=function(e){e instanceof u.plugin&&u.plugins.push(e)},u.init_plugins=function(e){t.setTimeout(function(){u._init_plugins(e)},0)},u._init_plugins=function(e){for(var t=u.plugins.length,n=null,i=0;i<t;i++)"function"==typeof(n=u.plugins[i].init)&&n(e)},u.show=function(e,t){var n=new u(e);return n.show(t),n},e.exports=u}else o.log("jsMind has been already exist.");function _(e,t,n){n&&(e.style.height="auto"),e.style.height=e.scrollHeight+"px",t.innerHTML=e.value,e.style.width=t.clientWidth+"px"}}("undefined"!=typeof window?window:t)}).call(this,n(121))},248:function(e,t){const n={note:{statusIcon:'<span style="pointer-events: none;margin-left:5px;color: greenyellow;text-shadow: 1px 1px 1px black;">●</span>'},flow:{statusIcon:'<span style="pointer-events: none;margin-left:5px;color: hotpink;text-shadow: 1px 1px 1px black;">●</span>'},url:{statusIcon:'<span style="pointer-events: none;margin-left:5px;color: deepskyblue;text-shadow: 1px 1px 1px black;">●</span>'},"app/todo":{statusIcon:'<span style="pointer-events: none;margin-left:5px;color: saddlebrown;text-shadow: 1px 1px 1px black;">●</span>'}},i={getIconHtml:function(e){return n[e]?n[e].statusIcon:'<span style="pointer-events: none;margin-left:5px;color: grey;text-shadow: 1px 1px 1px black;vertical-align:middle;">●</span>'},withIcon:function(e,t){return'<span style="pointer-events: none;max-width: 385px;overflow: hidden;text-overflow: ellipsis;vertical-align:middle;display: inline-block">'+e+"</span>"+this.getIconHtml(t)},toHtml:function(e){let t=e.split("\n");return t.length>20&&(e=t.slice(0,20).join("\n")+"\n……"),e.replace(/\n/g,"<br/>")}};e.exports=i},249:function(e,t,n){"use strict";function i(e,t){var n=t.document;if(e&&void 0===e.draggable){var i=e.util.dom,o=e.util.canvas,a="getSelection"in t?function(){t.getSelection().removeAllRanges()}:function(){n.selection.empty()},s=5,r=500,d=80;e.draggable=function(e){this.jm=e,this.e_canvas=null,this.canvas_ctx=null,this.shadow=null,this.shadow_w=0,this.shadow_h=0,this.active_node=null,this.target_node=null,this.target_direct=null,this.client_w=0,this.client_h=0,this.offset_x=0,this.offset_y=0,this.hlookup_delay=0,this.hlookup_timer=0,this.capture=!1,this.moved=!1},e.draggable.prototype={init:function(){this._create_canvas(),this._create_shadow(),this._event_bind()},resize:function(){this.jm.view.e_nodes.appendChild(this.shadow),this.e_canvas.width=this.jm.view.size.w,this.e_canvas.height=this.jm.view.size.h},_create_canvas:function(){var e=n.createElement("canvas");this.jm.view.e_panel.appendChild(e);var t=e.getContext("2d");this.e_canvas=e,this.canvas_ctx=t},_create_shadow:function(){var e=n.createElement("jmnode");e.style.visibility="hidden",e.style.zIndex="3",e.style.cursor="move",e.style.opacity="0.7",this.shadow=e},reset_shadow:function(e){var t=this.shadow.style;this.shadow.innerHTML=e.innerHTML,t.left=e.style.left,t.top=e.style.top,t.width=e.style.width,t.height=e.style.height,t.backgroundImage=e.style.backgroundImage,t.backgroundSize=e.style.backgroundSize,t.transform=e.style.transform,this.shadow_w=this.shadow.clientWidth,this.shadow_h=this.shadow.clientHeight},show_shadow:function(){this.moved||(this.shadow.style.visibility="visible")},hide_shadow:function(){this.shadow.style.visibility="hidden"},clear_lines:function(){o.clear(this.canvas_ctx,0,0,this.jm.view.size.w,this.jm.view.size.h)},_magnet_shadow:function(e){e&&(this.canvas_ctx.lineWidth=s,this.canvas_ctx.strokeStyle="rgba(0,0,0,0.3)",this.canvas_ctx.lineCap="round",this.clear_lines(),o.lineto(this.canvas_ctx,e.sp.x,e.sp.y,e.np.x,e.np.y))},_lookup_close_node:function(){var t,n,i=this.jm.get_root(),o=i.get_location(),a=i.get_size(),r=o.x+a.w/2,d=this.shadow_w,l=this.shadow_h,h=this.shadow.offsetLeft,c=this.shadow.offsetTop,u=h+d/2>=r?e.direction.right:e.direction.left,_=this.jm.mind.nodes,f=null,p=Number.MAX_VALUE,v=0,g=null,m=null,w=null;for(var y in _){var b,x;if((f=_[y]).isroot||f.direction==u){if(f.id==this.active_node.id)continue;if(t=f.get_size(),n=f.get_location(),u==e.direction.right){if(h-n.x-t.w<=0)continue;v=Math.abs(h-n.x-t.w)+Math.abs(c+l/2-n.y-t.h/2),b={x:n.x+t.w-s,y:n.y+t.h/2},x={x:h+s,y:c+l/2}}else{if(n.x-h-d<=0)continue;v=Math.abs(h+d-n.x)+Math.abs(c+l/2-n.y-t.h/2),b={x:n.x+s,y:n.y+t.h/2},x={x:h+d-s,y:c+l/2}}v<p&&(g=f,m=b,w=x,p=v)}}var k=null;return g&&(k={node:g,direction:u,sp:w,np:m}),k},lookup_close_node:function(){var e=this._lookup_close_node();e&&(this._magnet_shadow(e),this.target_node=e.node,this.target_direct=e.direction)},_event_bind:function(){var e=this,t=this.jm.view.container;i.add_event(t,"mousedown",function(t){var n=t||event;e.dragstart.call(e,n)}),i.add_event(t,"mousemove",function(t){var n=t||event;e.drag.call(e,n)}),i.add_event(t,"mouseup",function(t){var n=t||event;e.dragend.call(e,n)}),i.add_event(t,"touchstart",function(t){var n=t||event;e.dragstart.call(e,n)}),i.add_event(t,"touchmove",function(t){var n=t||event;e.drag.call(e,n)}),i.add_event(t,"touchend",function(t){var n=t||event;e.dragend.call(e,n)})},dragstart:function(e){if(this.jm.get_editable()&&!this.capture){this.active_node=null;var n=this.jm.view,i=e.target||event.srcElement;if("jmnode"==i.tagName.toLowerCase()){var o=n.get_binded_nodeid(i);if(o){var a=this.jm.get_node(o);if(!a.isroot){this.reset_shadow(i),this.active_node=a,this.offset_x=(e.clientX||e.touches[0].clientX)-i.offsetLeft,this.offset_y=(e.clientY||e.touches[0].clientY)-i.offsetTop,this.client_hw=Math.floor(i.clientWidth/2),this.client_hh=Math.floor(i.clientHeight/2),0!=this.hlookup_delay&&t.clearTimeout(this.hlookup_delay),0!=this.hlookup_timer&&t.clearInterval(this.hlookup_timer);var s=this;this.hlookup_delay=t.setTimeout(function(){s.hlookup_delay=0,s.hlookup_timer=t.setInterval(function(){s.lookup_close_node.call(s)},d)},r),this.capture=!0}}}}},drag:function(e){if(this.jm.get_editable()&&this.capture){e.preventDefault(),this.show_shadow(),this.moved=!0,a();var t=(e.clientX||e.touches[0].clientX)-this.offset_x,n=(e.clientY||e.touches[0].clientY)-this.offset_y;this.client_hw,this.client_hh;this.shadow.style.left=t+"px",this.shadow.style.top=n+"px",a()}},dragend:function(e){if(this.jm.get_editable()){if(this.capture){if(0!=this.hlookup_delay&&(t.clearTimeout(this.hlookup_delay),this.hlookup_delay=0,this.clear_lines()),0!=this.hlookup_timer&&(t.clearInterval(this.hlookup_timer),this.hlookup_timer=0,this.clear_lines()),this.moved){var n=this.active_node,i=this.target_node,o=this.target_direct;this.move_node(n,i,o)}this.hide_shadow()}this.moved=!1,this.capture=!1}},move_node:function(t,n,i){var o=this.shadow.offsetTop;if(n&&t&&!e.node.inherited(t,n)){for(var a=n.children,s=a.length,r=null,d=Number.MAX_VALUE,l=null,h="_last_";s--;)if((r=a[s]).direction==i&&r.id!=t.id){var c=r.get_location().y-o;c>0&&c<d&&(d=c,l=r,h="_first_")}l&&(h=l.id),this.jm.move_node(t.id,h,n.id,i)}this.active_node=null,this.target_node=null,this.target_direct=null},jm_event_handle:function(t,n){t===e.event_type.resize&&this.resize()}};var l=new e.plugin("draggable",function(t){var n=new e.draggable(t);n.init(),t.add_event_listener(function(e,t){n.jm_event_handle.call(n,e,t)})});e.register_plugin(l)}}n.r(t),n.d(t,"register",function(){return i})},250:function(e,t,n){"use strict";function i(e,t){if(e&&void 0===e.screenshot){var n=t.document,i=function(e){return n.createElement(e)},o=function(e,t){return e.getPropertyValue(t)},a=function(e){var t=o(e,"visibility"),n=o(e,"display");return"hidden"!==t&&"none"!==n},s=e.util.canvas;s.rect=function(e,t,n,i,o,a){i<2*a&&(a=i/2),o<2*a&&(a=o/2),e.moveTo(t+a,n),e.arcTo(t+i,n,t+i,n+o,a),e.arcTo(t+i,n+o,t,n+o,a),e.arcTo(t,n+o,t,n,a),e.arcTo(t,n,t+i,n,a)},s.text_multiline=function(e,t,n,i,o,a,s){var r="",d=t.length,l=t.split(""),h=null;e.textAlign="left",e.textBaseline="top";for(var c=0;c<d;c++)h=r+l[c],e.measureText(h).width>o&&c>0?(e.fillText(r,n,i),r=l[c],i+=s):r=h;e.fillText(r,n,i)},s.text_ellipsis=function(e,t,n,i,o,a){var r=i;e.textAlign="left",e.textBaseline="middle";let d=t.split("\n");d.length>20&&(d=d.slice(0,20)).push("……");let l=a/d.length;r-=l/2;for(let t of d){r+=l;let i=s.fittingString(e,t,o);e.fillText(i,n,r,o)}},s.fittingString=function(e,t,n){var i=e.measureText(t).width,o=e.measureText("…").width;if(i<=n||i<=o)return t;for(var a=t.length;i>=n-o&&a-- >0;)t=t.substring(0,a),i=e.measureText(t).width;return t+"…"},s.image=function(e,t,n,i,o,a,r,d,l){var h=new Image;h.onload=function(){e.save(),e.translate(n,i),e.save(),e.beginPath(),s.rect(e,0,0,o,a,r),e.closePath(),e.clip(),e.translate(o/2,a/2),e.rotate(d*Math.PI/180),e.drawImage(h,-o/2,-a/2),e.restore(),e.restore(),l()},h.src=t},e.screenshot=function(e){this.jm=e,this.canvas_elem=null,this.canvas_ctx=null,this._inited=!1},e.screenshot.prototype={init:function(){if(!this._inited){console.log("init");var e=i("canvas"),t=e.getContext("2d");this.canvas_elem=e,this.canvas_ctx=t,this.jm.view.e_panel.appendChild(e),this._inited=!0,this.resize()}},shoot:function(e){this.init();var t=this;this._draw(function(){e&&e(t),t.clean()}),this._watermark()},shootDownload:function(){this.shoot(function(e){e._download()})},shootAsDataURL:function(e){this.shoot(function(t){e(t.canvas_elem.toDataURL())})},resize:function(){this._inited&&(this.canvas_elem.width=this.jm.view.size.w,this.canvas_elem.height=this.jm.view.size.h)},clean:function(){var e=this.canvas_elem;this.canvas_ctx.clearRect(0,0,e.width,e.height)},_draw:function(e){var t=this.canvas_ctx;t.textAlign="left",t.textBaseline="top",this._draw_lines(),this._draw_nodes(e)},_watermark:function(){var e=this.canvas_elem,n=this.canvas_ctx;n.textAlign="right",n.textBaseline="bottom",n.fillStyle="#000",n.font="11px Verdana,Arial,Helvetica,sans-serif",n.fillText(window.location.host.endsWith("cc")?"notelive.cc":"notelive.cn",e.width-5.5,e.height-2.5),n.textAlign="left",n.fillText(t.location,5.5,e.height-2.5)},_draw_lines:function(){this.jm.view.show_lines(this.canvas_ctx)},_draw_nodes:function(e){var n,i=this.jm.mind.nodes;for(var o in i)n=i[o],this._draw_node(n);!function o(){console.log("check_node_ready"+new Date);var a=!0;for(var s in i)a&=(n=i[s]).ready;a?t.setTimeout(e,200):t.setTimeout(o,200)}()},_draw_node:function(e){var t=this.canvas_ctx,n=e._data.view,i=n.element,r=getComputedStyle(i);if(a(r)){var d=o(r,"background-color"),l=parseInt(o(r,"border-top-left-radius")),h=o(r,"color"),c=parseInt(o(r,"padding-left"))/2,u=parseInt(o(r,"padding-right"))/2,_=parseInt(o(r,"padding-top")),f=parseInt(o(r,"padding-bottom")),p=o(r,"text-overflow"),v=o(r,"font-style")+" "+o(r,"font-variant")+" "+o(r,"font-weight")+" "+o(r,"font-size")+"/"+o(r,"line-height")+" "+o(r,"font-family"),g={x:n.abs_x,y:n.abs_y,w:n.width+1,h:n.height+1},m={x:g.x+c,y:g.y+_,w:g.w-c-u,h:g.h-_-f};if(t.font=v,t.fillStyle=d,t.beginPath(),s.rect(t,g.x,g.y,g.w,g.h,l),t.closePath(),t.fill(),t.fillStyle=h,"background-image"in e.data){var w=o(r,"background-image").slice(5,-2);e.ready=!1;var y=0;"background-rotation"in e.data&&(y=e.data["background-rotation"]),s.image(t,w,g.x,g.y,g.w,g.h,l,y,function(){e.ready=!0})}if(e.topic)if("ellipsis"===p)s.text_ellipsis(t,e.topic,m.x,m.y,m.w,m.h);else{var b=parseInt(o(r,"line-height"));s.text_multiline(t,e.topic,m.x,m.y,m.w,m.h,b)}n.expander&&this._draw_expander(n.expander),"background-image"in e.data||(e.ready=!0)}else e.ready=!0},_draw_expander:function(e){var t=this.canvas_ctx,n=getComputedStyle(e);if(a(n)){var i=o(n,"left"),s=o(n,"top"),r=(o(n,"font"),parseInt(i)),d=parseInt(s),l="+"===e.innerHTML;t.lineWidth=1,t.beginPath(),t.arc(r+7,d+7,5,0,2*Math.PI,!0),t.moveTo(r+10,d+7),t.lineTo(r+4,d+7),l&&(t.moveTo(r+7,d+4),t.lineTo(r+7,d+10)),t.closePath(),t.stroke()}},_download:function(){var e=this.canvas_elem,t=this.jm.mind.name+".png";if(navigator.msSaveBlob&&e.msToBlob){var o=e.msToBlob();navigator.msSaveBlob(o,t)}else{var a=this.canvas_elem.toDataURL(),s=i("a");if("download"in s){s.style.visibility="hidden",s.href=a,s.download=t,n.body.appendChild(s);var r=n.createEvent("MouseEvents");r.initEvent("click",!0,!0),s.dispatchEvent(r),n.body.removeChild(s)}else location.href=a}},jm_event_handle:function(t,n){t===e.event_type.resize&&this.resize()}};var r=new e.plugin("screenshot",function(t){var n=new e.screenshot(t);t.screenshot=n,t.shoot=function(){n.shoot()},t.add_event_listener(function(e,t){n.jm_event_handle.call(n,e,t)})});e.register_plugin(r)}}n.r(t),n.d(t,"register",function(){return i})},258:function(e,t,n){"use strict";n.r(t);var i=n(12),o=n.n(i),a=n(116),s=n.n(a),r=(n(419),n(421),n(423),n(60)),d=n(16);const l=n(16).CONFIG.workspaceTitlePrefix;class h{constructor(e){return e&&(this.workspace=e.workspace,this.title=l+e.workspace,this.password=e.password,this.queryPassword=e.queryPassword,this.content=e.content,this.contentType="jsmind",this.lockType=e.lockType,this.updateTime=e.updateTime),this}getTitle(){return this.title}getQueryTitle(){return this.title}getWorkspace(){return this.workspace}getPassword(){return this.password}getQueryPassword(){return this.queryPassword}getContent(){return this.content}getLockType(){return this.lockType}getUpdateTime(){return this.updateTime}setWorkspace(e){return this.workspace=e,this.title=l+this.workspace,this}setPassword(e){return this.password=e,this}setQueryPassword(e){return this.queryPassword=e,this}setContent(e){return this.content=e,this}setLockType(e){return this.lockType=e,this}setUpdateTime(e){return this.updateTime=e,this}}const c={meta:{name:"rizon",author:"support@rizon.work",version:"0.1"},format:"node_tree",data:{id:"root",topic:"Mind",expanded:!0}};const u='<span title="离线模式下数据会保存在本地" style="display: flex; align-items: center; padding: 0 6px;width: 40px; height: 24px; border-radius: 3px;white-space: nowrap; font-size: 14px; color: rgba(55, 53, 47, 0.6); border: 1px solid rgba(55, 53, 47, 0.16);" class="">Offline</span><span style="display: flex;align-items: center;padding: 0 6px;height: 24px;margin-right: 18px;white-space: nowrap;font-size: 5px;color: rgba(55, 53, 47, 0.6);">本地保存</span>';var _=n(34),f=n(65);n(246).register(o.a);const p=n(247);let v,g,m,w,y,b,x;n(249).register(p,window),n(250).register(p,window),n(162).install();let k=!1,T=!1,j=!0,C=[],P=new class{constructor(e,t,n,i){this.getNoteFun=e,this.loadFun=t,this.saveFun=n,this.modifyPwdFun=i}bindPwdBtnEvent(){let e=this;this.password_obj=o()("#password"),this.password_div_obj=o()("#password_div"),this.password_btn_obj=o()("#password_btn"),this.readonly_btn_obj=o()("#readonly_btn"),this.newPassword_obj=o()("#new_password"),this.newPassword_div_obj=o()("#new_password_div"),this.newPassword_btn_obj=o()("#new_password_btn"),this.newPassword_cancel_obj=o()("#new_password_cancel"),this.lockType_obj=o()("#lockType");let t=function(){e.getNoteFun().setPassword(e.password_obj.val()).setQueryPassword(e.password_obj.val()),e.closePasswordQueryBox.call(e),e.authQuery?e.loadFun():e.saveFun()};this.password_obj.on("keypress",function(e){13===e.keyCode&&t()}),this.readonly_btn_obj.on("click",()=>{e.getNoteFun().setQueryPassword(null),e.closePasswordQueryBox.call(e),window.location.reload()}),o()("#modify_password").on("click",this.showPasswordModifyBox.bind(this)),this.password_btn_obj.on("click",t),this.newPassword_btn_obj.on("click",function(){let t=e.getNoteFun();t.setPassword(e.newPassword_obj.val()),t.getPassword()?t.setLockType(e.lockType_obj.val()):t.setLockType(null),e.closePasswordModifyBox.call(e),e.modifyPwdFun()}),this.newPassword_cancel_obj.on("click",function(){e.closePasswordModifyBox.call(e)})}showPasswordQueryBox(e=!0){this.authQuery=e,this.password_div_obj.show(),this.password_obj.focus(),this.onPwdQueryBox=!0}closePasswordQueryBox(){this.password_div_obj.hide(),this.password_obj.val(""),this.onPwdQueryBox=!1}showPasswordModifyBox(){this.newPassword_div_obj.show(),this.newPassword_obj.focus(),this.newPassword_obj.val(this.getNoteFun().getPassword()),this.lockType_obj.val(this.getNoteFun().getLockType()||"rw"),this.onPwdModifyBox=!0}closePasswordModifyBox(){this.newPassword_div_obj.hide(),this.onPwdModifyBox=!1}}(()=>y,()=>D(),()=>V(y),()=>{(S=y,new Promise((e,t)=>{o.a.ajax({type:"POST",url:d.SERVER_PATH.modifyWorkspacePwd,data:{title:S.getQueryTitle(),queryPassword:S.getQueryPassword(),password:S.getPassword(),lockType:S.getLockType()},success:function(t){if(t){let n=new d.Response(t);if(n.getCode()===d.CONFIG.responseCode.SUCCESS)return z(),N.status2saved(),console.log("update data"),window.workspace=S,Object(_.c)(S),void e(!0);n.getCode()===d.CONFIG.responseCode.NO_AUTH?P.showPasswordQueryBox(!1):(console.error(n),N.status2error("保存失败，"+n.getMsg()))}else console.error("保存失败,返回数据为空"),N.status2error("保存失败");e()},error:function(t){t&&413===t.status?N.status2MaxLengthLimit():(console.error(t),N.status2notConnect()),e()}})})).then(e=>{e&&(y.setQueryPassword(y.getPassword()),Object(_.c)(y))})});var S;let N=new class{constructor(){this.saveStatus=1}register(e){this.tip_obj=e}status2saved(){0===this.saveStatus&&this.tip_obj.html("已保存"),this.saveStatus=1}status2unsave(){1===this.saveStatus&&this.tip_obj.html("未保存"),this.saveStatus=0}status2error(e){this.tip_obj.html(u),this.saveStatus=0}status2notConnect(){this.status2error("保存失败，服务器连接失败")}status2MaxLengthLimit(){this.tip_obj.html("<span style='color: red'>保存失败，超过长度限制</span>")}getSaveStatus(){return this.saveStatus}},M={note:{getUrl:function(e,t){return"/#"+r.d(e,t)}},flow:{getUrl:function(e,t){return"/flow/#"+r.d(e,t)}},"app/todo":{getUrl:function(e,t){return"/app?tid=todo#"+r.d(e,t)}}};function E(e,t){"url"===t.data.nodeType?(e.show(),e.val(t.data.urlNodeValue),e.off("input"),e.on("input",()=>{t.data.urlNodeValue=e.val(),t.data.hasNote!==!!t.data.urlNodeValue&&(t.data.hasNote=!!t.data.urlNodeValue,Q(t))})):(e.hide(),e.off("input"),e.val(""))}function I(){g.is(":visible")?(T=!1,g.hide()):(T=!0,f.AppEventInstance.emit(f.EventType.jsMindSelectNode,b.get_selected_node()),g.show())}function O(e){r.e(e.getLockType(),e.getQueryPassword())?function(){j=!0,b&&(b.options.editable=!1);o()("[readonlyhide]").hide(),w.show()}():z()}function z(){j&&(j=!1,b&&(b.options.editable=!0),o()("[readonlyhide]").show(),w.hide())}function W(){if(j)return;let e=JSON.stringify(b.get_data());x!==e&&(N.status2unsave(),y.setContent(e),Object(_.c)(y),V(y))}o()(function(){(v=o()(".tab_box")).initCardTabs(),o()(".card-tabs-bar a[data-a_tab=Mind]").on("click",()=>q()),o()(window).on("keydown",R),g=o()("#jsmind_tools"),m=o()("#shortcutHelpDiv"),function(){let e=0,t=document.cookie.match(/(^| )closeMindShortcutHelpCount=([^;]*)(;|$)/);if(t&&(e=parseInt(t[2])||0),e<3){m.show();let t=()=>{console.log("close shortcut help");let n=new Date;n.setTime(n.getTime()+31536e6),document.cookie="closeMindShortcutHelpCount="+(e+1)+";expires="+n.toUTCString(),o()("#shortcutHelp").off("click",null,t)};o()("#shortcutHelp").on("click",t)}}(),function(){y=new h;let e=location.hash;if(void 0===e||null==e||""===e){let t=localStorage.getItem("lastWorkspace");t?e=t:(e=r.g(),console.log("random workspace:"+e))}else console.log("load from hash:"+e),e=decodeURI(e.substr(1)).replace(/\W/g,"").substring(0,8);location.hash=e,y.setWorkspace(e),function(e){let t=Object(_.a)(e.getTitle());t&&e.setQueryPassword(new d.Note(JSON.parse(t)).getQueryPassword())}(y),D(),function(e){localStorage.setItem("lastWorkspace",e)}(e),document.title=e+" @ Mind - note live"}(),window.onhashchange=(()=>window.location.reload()),window.onbeforeunload=(e=>{j||b&&(W(),0===N.getSaveStatus()&&(e.returnValue="有尚未保存的数据，现在退出可能会丢失数据"))}),P.bindPwdBtnEvent(),N.register(o()("#tip")),(w=o()("#editDoc")).on("click",()=>P.showPasswordQueryBox(!1)),o()("#delete_data").on("click",L),o()("#jsmind_toolsBtn").on("click",e=>{I()}),o()("#shortcutHelp").on("click",e=>{m.toggle()}),function(){let e=o()("#select_freemind_file"),t=o()("#jsmind_tools_zoom_in"),n=o()("#jsmind_tools_zoom_out");t.on("click",function(){b.view.zoomIn()?n.removeAttr("disabled"):t.attr("disabled","disabled")}),n.on("click",function(){b.view.zoomOut()?t.removeAttr("disabled"):n.attr("disabled","disabled")}),window.jmUtils={mind_screen_shot:function(){b.screenshot.shootDownload()},save_freemind_file:function(){let e=b.get_data("freemind"),t=e.meta.name||"freemind",n=e.data;p.util.file.save(n,"text/xml",t+".mm")},open_freemind:function(){e.trigger("click")},load_freemind:function(){let t=document.getElementById("select_freemind_file"),n=t.files;if(n.length>0){let t=n[0];e.val(""),p.util.file.read(t,function(e,t){if(e){let n=t;/.*\.mm$/.test(n)&&(n=t.substring(0,t.length-3));let i=o.a.extend(!0,c,{meta:{name:n}});i=o.a.extend(i,{format:"freemind",data:e});let a=b.get_data();b.show(i);let s=b.get_data();s.data.topic=r.a("yyyy-MM-dd",new Date)+"导入: "+s.data.topic,function e(t){if(!t)return;for(let n of t)n.id=p.util.uuid.newid(),e(n.children)}([s.data]),a.data.children||(a.data.children=[]),a.data.children.push(s.data),b.show(a),F()}else alert("can not open this file as mindmap")})}else alert("please choose a file first")},set_theme:function(e){b.set_theme(e)}}}(),function(){window.globalKeyDownEvent=R,window.updateHasNoteFun=function(e,t){let n=r.b(e);n&&(t?-1===C.indexOf(n)&&C.push(n):C=C.filter(e=>e!==n))};let e=o()("#nodeSettings"),t=o()("#set_node_type_select"),n=o()("#url_type_node_value");n.on("focus",()=>k=!0).on("blur",()=>k=!1),t.on("change",function(){let e=b.get_selected_node();e&&e.data.nodeType!==t.val()&&(e.data.nodeType=t.val(),E(n,e),"url"!==t.val()&&delete e.data.urlNodeValue,Q(e))}),f.AppEventInstance.on(f.EventType.jsMindSelectNode,i=>{j||T&&(i?(t.val(i.data.nodeType||"note"),e.show(),E(n,i)):e.hide())})}()});let A=s.a.throttle(function(){V(y)},5e3,{leading:!0});function H(e){if(j&&!e.data.hasNote)return;if("url"===e.data.nodeType)return void(e.data.urlNodeValue&&window.open(e.data.urlNodeValue.match(/^[A-Za-z]+:\/\//)?e.data.urlNodeValue:"http://"+e.data.urlNodeValue,"_blank"));let t=e.id;if(!v.hasCardTab(t)){let n=e.topic,i=e.data.nodeType;n.length>10&&(n=n.substr(0,10)+"…");let a=o()("#note_template").clone();a.attr("data-tab",t);let s=a.children("iframe"),r=function(e,t,n){if(!M[e=e||"note"])return;return M[e].getUrl.call(this,t,n)}(i,y.getWorkspace(),t);s.attr("src",r),s.ready(()=>{o()(s.get(0).contentWindow).on("keydown",R),s.get(0).contentWindow.noteName=e.topic+" - "+y.getWorkspace()}),v.appendCardTabs(t,n,a,B)}v.openCardTab(t),W()}function L(){var e;window.confirm("将会删除该Mind和所有数据，确定要删除吗？")&&(e=y,new Promise((t,n)=>{o.a.ajax({type:"POST",url:d.SERVER_PATH.delWorkspace,data:{title:e.getQueryTitle(),queryPassword:e.getQueryPassword()},success:function(e){if(e){let n=new d.Response(e);if(n.getCode()===d.CONFIG.responseCode.SUCCESS)return void t(!0);n.getCode()===d.CONFIG.responseCode.NO_AUTH?P.showPasswordQueryBox(!1):(console.error(n),N.status2error("保存失败，"+n.getMsg()))}else console.error("保存失败,返回数据为空"),N.status2error("保存失败");t()},error:function(e){e&&413===e.status?N.status2MaxLengthLimit():(console.error(e),N.status2notConnect()),t()}})})).then(e=>{e&&(window.onbeforeunload=null,window.location.reload())})}function R(e){e.altKey&&87===e.keyCode&&function(e){let t=v.getActiveId();if(!B(t))return void e.preventDefault();v.removeCardTabActivePre(t)}(e),!e.altKey||49!==e.keyCode&&65!==e.keyCode||v.openCardTab("Mind")}function B(e){if("Mind"===e)return!1;let t=v.find(".card-tabs-stack div[data-tab="+e+"] iframe").get(0);if(t&&t.contentWindow.getSaveStatus){let e=t.contentWindow.getSaveStatus();if(1!==e)return"string"==typeof e?confirm(""+e):confirm("当前文档尚未保存，如果关闭将会丢失未保存的数据，确认关闭？")}return!0}function D(){o.a.ajax({type:"POST",url:d.SERVER_PATH.queryOne,data:{title:y.getQueryTitle(),queryPassword:y.getQueryPassword()},success:function(e){if(e){let t=new d.Response(e);if(t.getCode()===d.CONFIG.responseCode.SUCCESS){if(t.getData()){let e=y.getQueryPassword(),n=y.getWorkspace();(y=new h(t.getData())).setWorkspace(n),y.setQueryPassword(e),y.setPassword(e),window.workspace=y,x=y.getContent(),O(y)}else z();U(y)}else t.getCode()===d.CONFIG.responseCode.NO_AUTH?P.showPasswordQueryBox.call(P,!0):(console.error(t),N.status2error("读取数据错误,"+t.getMsg()))}},error:function(e){console.error(e),N.status2error("读取数据失败,服务器连接失败"),z(),function(){let e=Object(_.a)(y.getTitle());e&&(y=new h(JSON.parse(e)),x=y.getContent(),U(y),console.log("load from localStorage"))}()}})}function U(e){let t,n=e.getContent();if(n)try{t=o.a.extend(c,JSON.parse(n))}catch(i){console.error("workspace数据格式错误,重置数据",n),t=o.a.extend(!0,c,{meta:{name:e.getWorkspace()},data:{id:"root",topic:e.getWorkspace(),expanded:!0}})}else t=o.a.extend(!0,c,{meta:{name:e.getWorkspace()},data:{id:"root",topic:e.getWorkspace(),expanded:!0}});let i={container:"jsmind_container",editable:!j,theme:"primary",shortcut:{isHandleCancel:function(){return k||P.onPwdQueryBox||P.onPwdModifyBox},mapping:{delnode:null,addchild:null,newDelnode:8,newDelnode2:46,addbrother:13,newAddchild:9,editnode:32,toggle:2040,openNote:1013,toggleSettings:2069,saveMind:1083,anykey:"anykey"},handles:{openNote:function(e,t){H(e.get_selected_node())},newAddchild:function(e,t){p.shortcut_provider.prototype.handle_addchild(e,t),t.preventDefault()},newDelnode:$,newDelnode2:$,toggleSettings:function(e,t){I()},saveMind:function(e,t){j||(console.log("save"),W(),t.preventDefault())},anykey:function(e,t){j||function(){let e=JSON.stringify(b.get_data());x!==e&&(N.status2unsave(),y.setContent(e),Object(_.c)(y),A())}()}}}};b=p.show(i,t),n||(x=JSON.stringify(b.get_data())),F()}function $(e,t){let n=e.get_selected_node();n&&(n.isroot||function e(t){if(t.data.hasNote)return!0;for(let n of t.children)if(e(n))return!0;return!1}(n)&&!window.confirm("将会同时删除该主题以及子主题的所有数据，确定要删除吗？")||function(e){let t=e.id;return new Promise(e=>{let n=new d.Note;n.setContent(null).setTitle(r.d(y.getWorkspace(),t)).setQueryPassword(y.getPassword()),V(n).then(n=>{n&&(v.removeCardTab(t),e())})})}(n).then(()=>{p.shortcut_provider.prototype.handle_delnode(e,t)}))}function F(){var e;(e=y,new Promise((t,n)=>{o.a.ajax({type:"POST",url:d.SERVER_PATH.queryWorkspaceTitles,data:{title:e.getQueryTitle()},success:function(e){if(e){let n=new d.Response(e);if(n.getCode()===d.CONFIG.responseCode.SUCCESS)return void t(n.getData());console.error(n)}else console.error("保存失败,返回数据为空");t()},error:function(e){console.error(e),t()}})})).then(e=>{C=e?e.map(e=>{if(e&&e.title)return r.b(e.title)}).filter(e=>e):[],q()})}function q(){let e=b.get_data(),t=b.get_selected_node();!function e(t,n){if(!n)return;for(let i of n)"url"===i.nodeType?i.hasNote=!!i.urlNodeValue:i.hasNote=-1!==t.indexOf(i.id),e(t,i.children)}(C,[e.data]),b.show(e),t&&t.id&&b.select_node(t.id)}function Q(e){e&&("url"===e.data.nodeType?e.data.hasNote=!!e.data.urlNodeValue:e.data.hasNote=-1!==C.indexOf(e.id),b.view.update_node(e),b.view.show(!1))}function V(e){return new Promise((t,n)=>{o.a.ajax({type:"POST",url:d.SERVER_PATH.replaceOrInsertOne,data:e,success:function(n){if(n){let i=new d.Response(n);if(i.getCode()===d.CONFIG.responseCode.SUCCESS)return z(),N.status2saved(),console.log("update data"),window.workspace=e,Object(_.c)(e),x=e.getContent(),void t(!0);i.getCode()===d.CONFIG.responseCode.NO_AUTH?P.showPasswordQueryBox(!1):(console.error(i),N.status2error("保存失败，"+i.getMsg()))}else console.error("保存失败,返回数据为空"),N.status2error("保存失败");t()},error:function(e){e&&413===e.status?N.status2MaxLengthLimit():(console.error(e),N.status2notConnect()),t()}})})}},34:function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"a",function(){return s}),n.d(t,"b",function(){return a});const i="note.local.notes.";function o(e){let t=r(e.getTitle());void 0===e.getContent()||null===e.getContent()||""===e.getContent()?(localStorage.removeItem(t),console.log("remove note from localStorage:"+e.getTitle())):localStorage.setItem(t,JSON.stringify(e))}function a(e){localStorage.removeItem(r(e))}function s(e){return localStorage.getItem(r(e))}function r(e){return i+e}},413:function(e,t){},419:function(e,t){},421:function(e,t){},423:function(e,t){},60:function(e,t,n){"use strict";n.d(t,"f",function(){return a}),n.d(t,"g",function(){return s}),n.d(t,"c",function(){return r}),n.d(t,"d",function(){return d}),n.d(t,"a",function(){return l}),n.d(t,"b",function(){return h}),n.d(t,"e",function(){return c});var i=n(16);function o(e){e=e||32;const t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length;let i="";for(let o=0;o<e;o++)i+=t.charAt(Math.floor(Math.random()*n));return i}function a(){return o(4)}function s(){return o(4)}function r(e){let t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=decodeURI(window.location.search).substr(1).match(t);return null!=n?unescape(n[2]):null}function d(e,t){return i.CONFIG.workspaceTitlePrefix+e+"/"+t}function l(e,t){let n={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(let t in n)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?n[t]:("00"+n[t]).substr((""+n[t]).length)));return e}function h(e){if(!e)return null;let t=e.match(/^\/*w\/+\w+\/+(\w+)/);return t&&2===t.length?t[1]:null}function c(e,t){return e&&-1!==e.indexOf("w")&&!t}},65:function(e,t){let n=null;n||(n=new class{constructor(){let e=this;e.app_events={},e.emit=function(t,n){let i=e.app_events[t];if(i&&i.length)for(let e=0;e<i.length;e++)if(i[e])try{i[e](n)}catch(e){console.error(t+": Listener ERROR",e)}},e.on=function(t,n){e.app_events[t]||(e.app_events[t]=[]),e.app_events[t].push(n)},e.off=function(t,n){let i=e.app_events[t];if(i&&i.length){let e=i.indexOf(n);i.splice(e,1)}}}}),e.exports={EventType:{WindowKeydown:"WindowKeydown",NoteChanged:"NoteChanged",jsMindSelectNode:"jsMindSelectNode"},AppEventInstance:n}}});